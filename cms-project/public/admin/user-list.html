<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title></title>
    <!-- Bootstrap -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/base.css"/>
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">CMS管理系统</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- <li><a href="#">Link</a></li> -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">
                        admin
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">个人资料</a></li>
                        <li><a href="#">通知信息</a></li>
                        <li><a href="#">收到的评论</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">退出登录</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="main">
    <div class="left-side">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading1">
                    <h4 class="panel-title">
                        <a role="button" href="#">
                            <span class="glyphicon glyphicon-fire"></span>
                            信息面板
                        </a>
                    </h4>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading2">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse2"
                           aria-expanded="false" aria-controls="collapseTwo">
                            <span class="glyphicon glyphicon-tasks"></span>
                            文章管理
                        </a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="article-list.html">
                                <span class="glyphicon glyphicon-th-list"></span>
                                文章列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="article-add.html">
                                <span class="glyphicon glyphicon-pencil"></span>
                                发布文章
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading3">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse3"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-equalizer"></span>
                            栏目管理
                        </a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="category-list.html">
                                <span class="glyphicon glyphicon-list"></span>
                                栏目列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="category-add.html">
                                <span class="glyphicon glyphicon-plus"></span>
                                添加栏目
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading4">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse4"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-bullhorn"></span>
                            公告管理
                        </a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-bell"></span>
                                公告列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-send"></span>
                                发布公告
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading5">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse5"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-comment"></span>
                            评论管理
                        </a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-paperclip"></span>
                                评论列表
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading6">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse6"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-user"></span>
                            用户管理
                        </a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-tags"></span>
                                用户组
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="user-list.html">
                                <span class="glyphicon glyphicon-list-alt"></span>
                                用户列表
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="right-content">
        <!-- 表格 -->
        <div class="panel panel-primary">
            <div class="panel-heading">用户列表</div>
            <div class="panel-body">
                <!-- Table -->
                <table class="table">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>用户名</th>
                        <th>姓名</th>
                        <th>手机</th>
                        <th>角色</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- <tr>
                        <td>1</td>
                        <td>moz</td>
                        <td>黄小米</td>
                        <td>15863008280</td>
                        <td>管理员</td>
                        <td>
                            <button type="button" class="btn btn-default btn-xs">
                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> 编辑
                            </button>
                            <button type="button" class="btn btn-default btn-xs">
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> 删除
                            </button>
                        </td>
                    </tr> -->
                    </tbody>
                </table>
            </div>


        </div>
    </div>
</div>
<!-- modal模态框 -->
<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">确定</h4>
            </div>
            <div class="modal-body">
                <p>确定删除该用户吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmBtn">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- 编辑模态框 -->
<div class="modal fade" tabindex="-1" role="dialog" id="editModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">编辑</h4>
            </div>
            <div class="modal-body">
                <!-- 用户名 -->
                <div class="form-group">
                    <label for="InputUsername">用户名</label>
                    <input type="email" class="form-control" id="InputUsername" placeholder="请输入登录用户名">
                </div>
                <!-- 姓名 -->
                <div class="form-group">
                    <label for="InputFullname">姓名</label>
                    <input type="text" class="form-control" id="InputFullname" placeholder="请输入姓名">
                </div>
                <!-- 手机号 -->
                <div class="form-group">
                    <label for="InputTel">手机</label>
                    <input type="number" class="form-control" id="InputTel" placeholder="请输入手机号码">
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="editBtn">保存</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="lib/jquery-3.3.1.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        //获取用户列表
        $.getJSON("/users/getlist", function (result) {
            console.log(result);
            // JSON.parse
            if (result.status) {
                var html = "";
                result.msg.forEach(function (item) {
                    html += `<tr>
								<td>${item.users_id}</td>
								<td>${item.username}</td>
								<td>${item.fullname}</td>
								<td>${item.tel}</td>
								<td>管理员</td>
								<td>
									<button type="button" class="btn btn-default btn-xs edit" 
									data-name="${item.username}"
									data-full="${item.fullname}"
									data-tel="${item.tel}"
									data-id="${item.users_id}"	>
										<span class="glyphicon glyphicon-edit" aria-hidden="true"></span> 编辑
									</button>
									<button type="button" class="btn btn-default btn-xs delete" data-id="${item.users_id}">
										<span class="glyphicon glyphicon-trash"  aria-hidden="true"></span> 删除
									</button>
								</td>
							</tr>`
                });
                $("table tbody").append(html)
            }
            // console.log(result);
        })
        // 同步传输
        // $.ajax({
        // 	type: "GET",
        // 	url: "/users/list",
        // 	async: false,
        // 	success: function () {
        // 		console.log('1');
        // 	}
        // })
        // $.ajax({
        // 	type: "GET",
        // 	url: "/users/list",
        // 	async: false,
        // 	success: function () {
        // 		console.log('2');
        // 	}
        // })
        // console.log('3');


        // 删除操作
        $("tbody").on("click", ".delete", function () {
            $("#deleteModal").modal("show");
            // 获取要删除的id
            var uid = $(this).data("id");
            // console.log(uid);
            // 转存id
            $("#confirmBtn").data("id", uid);
        })


        // 确认删除
        $("#confirmBtn").click(function () {
            //提取id
            var uid = $(this).data("id");
            $.post("/users/delete", {
                id: uid
            }, function (result) {


                if (result.status) {
                    $("#deleteModal").modal("hide");
                    //刷新页面 location.reload()
                    // window.location.reload();
                    $("tbody>tr").each(function () {
                        var $td = $(this).find("td").eq(0);
                        var id = $td.text();
                        if (id == uid) {
                            $(this).remove();
                        }
                    })
                }
            })
        })


        // 编辑操作
        $("tbody").on("click", ".edit", function () {
            $("#editModal").modal("show");
            // 获取要删除的id
            var uid = $(this).data("id");
            // 获取要删除的信息
            var name = $(this).data("name");
            var full = $(this).data("full");
            var tel = $(this).data("tel");
            // 转值
            // console.log(uid);
            $.getJSON("/users/info", {
                id: uid
            }, function (result) {
                if (result.status) {
                    $("#InputUsername").val(result.msg.username);
                    $("#InputFullname").val(result.msg.fullname);
                    $("#InputTel").val(result.msg.tel);
                }
            })
            $("#editBtn").data("id", uid);
        })


        // 确定编辑
        $("#editBtn").click(function () {
            //提取id
            var uname = $("#InputUsername").val();
            var ufull = $("#InputFullname").val();
            var utel = $("#InputTel").val();

            //提取id
            var uid = $(this).data("id");
            $.post("/users/edit", {
                users_id: uid,
                username: uname,
                fullname: ufull,
                tel: utel
            }, function (result) {
                console.log(result)
                if (result.status) {
                    $("#editModal").modal("hide");
                    // 	//刷新页面 location.reload()
                    // 	// window.location.reload();
                    $("tbody>tr").each(function () {
                        var $td = $(this).find("td").eq(0);
                        var id = $.trim($td.text());
                        if (id == uid) {
                            // $(this).remove();
                            $(this).find("td:eq(1)").text(uname);
                            $(this).find("td:eq(2)").text(ufull);
                            $(this).find("td:eq(3)").text(utel);

                        }
                    })
                }
            })
        })


    })
</script>
</body>

</html>